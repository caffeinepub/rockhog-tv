{
  "kind": "build_request",
  "title": "Add live chat room for real-time user communication",
  "projectName": "RockHog TV",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-46",
      "text": "Create a new ChatRoom data type in the backend that stores chat room metadata (room ID, room name, creation timestamp) and an array of chat messages (message ID, sender principal, sender display name, message text, timestamp)",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-5"
        ],
        "quotes": [
          "ADD A LIVE CHAT ROOM"
        ]
      },
      "acceptanceCriteria": [
        "ChatRoom type includes: id (Text), name (Text), createdAt (Int), and messages array",
        "ChatMessage type includes: id (Text), senderPrincipal (Principal), senderName (Text), text (Text), timestamp (Int)",
        "Data structures support efficient message storage and retrieval"
      ]
    },
    {
      "id": "REQ-47",
      "text": "Add backend methods to create a new chat room, retrieve all chat rooms, retrieve messages for a specific chat room by ID, and post a new message to a chat room (authenticated users only)",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-5"
        ],
        "quotes": [
          "ADD A LIVE CHAT ROOM"
        ]
      },
      "acceptanceCriteria": [
        "createChatRoom method creates a new room and returns its ID",
        "getAllChatRooms returns an array of all chat rooms",
        "getChatRoomMessages(roomId) returns all messages for the specified room",
        "postMessage(roomId, text) creates a message with authenticated caller's principal and display name",
        "postMessage requires authentication and returns error for anonymous callers"
      ]
    },
    {
      "id": "REQ-48",
      "text": "Create React Query hooks for chat room operations: useGetChatRooms to fetch all chat rooms, useGetChatRoomMessages to fetch messages for a specific room with polling enabled for real-time updates, and usePostMessage mutation to send new messages",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-5"
        ],
        "quotes": [
          "ADD A LIVE CHAT ROOM"
        ]
      },
      "acceptanceCriteria": [
        "useGetChatRooms hook fetches and caches all available chat rooms",
        "useGetChatRoomMessages hook fetches messages for a room and polls every 2-3 seconds for updates",
        "usePostMessage mutation sends messages and invalidates the messages query on success",
        "All hooks properly handle loading and error states"
      ]
    },
    {
      "id": "REQ-49",
      "text": "Create a ChatRoomPage component that displays a list of available chat rooms in a sidebar, shows the selected room's message history in the main area with sender names and timestamps, and includes a ChatInput component at the bottom for sending messages",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-5"
        ],
        "quotes": [
          "ADD A LIVE CHAT ROOM"
        ]
      },
      "acceptanceCriteria": [
        "Page layout includes a sidebar with clickable chat room list and a main message area",
        "Messages display sender name, text content, and formatted timestamp",
        "ChatInput component is positioned at the bottom of the message area",
        "Page auto-scrolls to newest messages when they arrive",
        "Anonymous users see a prompt to log in before accessing chat"
      ]
    },
    {
      "id": "REQ-50",
      "text": "Add a route for the chat room page at /chat-room in the application router and add a primary navigation entry point labeled 'Chat Room' in the PrimaryNav component so users can access it from anywhere in the app",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-5"
        ],
        "quotes": [
          "ADD A LIVE CHAT ROOM"
        ]
      },
      "acceptanceCriteria": [
        "Route /chat-room is registered in the router and renders ChatRoomPage",
        "PrimaryNav includes a 'Chat Room' link that navigates to /chat-room",
        "Navigation entry is visible to all users (authenticated and anonymous)",
        "Active route highlighting works for the chat room link"
      ]
    },
    {
      "id": "REQ-51",
      "text": "Create a cohesive visual theme for the chat room interface that emphasizes real-time communication and community interaction, using distinct colors and styling from both the RockHog TV streaming experience and the AI Chat interface",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-5"
        ],
        "quotes": [
          "ADD A LIVE CHAT ROOM"
        ]
      },
      "acceptanceCriteria": [
        "Chat room interface has a unique color scheme defined in the theme system",
        "Message bubbles, room list, and input area follow consistent styling",
        "Theme emphasizes community and real-time interaction through visual design",
        "Layout is responsive and works well on both desktop and mobile devices"
      ]
    },
    {
      "id": "REQ-52",
      "text": "Initialize at least one default chat room (e.g., 'General Chat' or 'RockHog Lounge') during backend initialization so users have a place to chat immediately after the feature is deployed",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-5"
        ],
        "quotes": [
          "ADD A LIVE CHAT ROOM"
        ]
      },
      "acceptanceCriteria": [
        "Backend creates a default chat room on first initialization",
        "Default room has a welcoming name like 'General Chat' or 'RockHog Lounge'",
        "Default room is immediately available in the getAllChatRooms response",
        "Existing deployments can upgrade without losing data"
      ]
    }
  ],
  "constraints": [
    "Do not implement WebSockets or Socket.io for real-time communication; use polling with React Query instead",
    "Chat room feature must work within the single-actor Motoko backend architecture",
    "Do not modify immutable frontend paths: useInternetIdentity.ts, useActor.ts, main.tsx, or components/ui directory",
    "Reuse the existing ChatInput component from frontend/src/components/chat/ChatInput.tsx"
  ],
  "nonGoals": [
    "Real-time WebSocket connections or server push",
    "Private direct messaging between users",
    "Message editing or deletion functionality",
    "Rich text formatting or emoji picker",
    "File/image sharing in chat messages",
    "Chat room moderation tools or admin controls",
    "User presence indicators or typing indicators",
    "Message read receipts or delivery confirmation"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}